# 遊戲管理後台系統 - 開發任務列表

基於 `prd-game-management-backend.md` 的功能需求分析

## Relevant Files

- `backend/main.go` - 應用程式主要入口點，包含基本 Gin 服務器設定
- `backend/go.mod` - Go 模組定義文件，包含專案依賴
- `backend/go.sum` - Go 模組校驗檔案
- `backend/bin/nexus-gaming-backend` - 編譯後的可執行檔案
- `backend/models/user.go` - 使用者模型定義，包含角色管理以及密碼加密功能
- `backend/models/player.go` - 玩家資料模型，包含基本資料、錢包、標籤、限制設定等完整玩家管理功能
- `backend/models/game.go` - 遊戲相關模型定義
- `backend/models/order.go` - 訂單、購物車、願望清單模型
- `backend/models/review.go` - 評論和評分相關模型
- `backend/models/financial.go` - 財務相關模型
- `backend/models/agent.go` - 代理商/經銷商模型
- `database/init/05-agents.sql` - 代理商/經銷商相關表結構，包含多層級分潤系統
- `backend/controllers/auth.go` - 身份驗證控制器
- `backend/controllers/player.go` - 玩家控制器，實現玩家列表查詢、詳細資訊查詢、遊戲歷史查詢 API（支援分頁、排序、搜尋、篩選）
- `backend/controllers/game.go` - 遊戲管理控制器
- `backend/controllers/financial.go` - 財務管理控制器
- `backend/controllers/agent.go` - 代理商管理控制器
- `backend/controllers/report.go` - 報表功能控制器
- `backend/services/auth.go` - 身份驗證服務
- `backend/services/game.go` - 遊戲邏輯服務
- `backend/services/financial.go` - 財務計算服務
- `backend/middleware/auth.go` - 身份驗證中介軟體
- `backend/middleware/permission.go` - 權限控制中介軟體
- `frontend/package.json` - Next.js 專案配置和依賴
- `frontend/tsconfig.json` - TypeScript 配置
- `frontend/next.config.ts` - Next.js 配置
- `frontend/tailwind.config.ts` - Tailwind CSS 配置
- `frontend/src/app/layout.tsx` - 根佈局組件（App Router）
- `frontend/src/app/page.tsx` - 首頁組件
- `frontend/src/app/globals.css` - 全域樣式文件
- `frontend/components/Layout.tsx` - 主要佈局組件
- `frontend/components/Dashboard.tsx` - 儀表板組件
- `frontend/components/PlayerManagement.tsx` - 玩家管理界面
- `frontend/components/GameManagement.tsx` - 遊戲管理界面
- `frontend/components/FinancialManagement.tsx` - 財務管理界面
- `frontend/components/AgentManagement.tsx` - 代理商管理界面
- `frontend/components/ReportAnalysis.tsx` - 報表分析界面
- `frontend/services/api.ts` - API 服務層
- `docker-compose.yml` - Docker Compose 配置文件（MySQL, Redis, PHPMyAdmin）
- `env.example` - 環境變數範例文件
- `database/init/01-init.sql` - 資料庫初始化 SQL 腳本
- `scripts/dev-setup.sh` - 開發環境設置腳本
- `database/migrations/` - 資料庫遷移文件
- `config/config.go` - 系統配置文件
- `config/database.go` - 資料庫連線配置與管理
- `backend/controllers/admin.go` - 管理員控制器處理登入、使用者管理等功能
- `backend/controllers/middleware.go` - 中介軟體包含身份驗證和權限檢查
- `backend/routes/routes.go` - 路由設定包含所有 API 端點
- `api.json` - PM2 管理使用的 API 文檔，包含所有實現的 API 端點詳細說明

### Notes

- 採用 Golang + Gin 框架作為後端架構
- 使用 Next.js + React 作為前端框架
- MySQL 作為主要資料庫，Redis 用於快取
- 採用 JWT 進行身份驗證
- 使用 GORM 進行 ORM 操作
- 前後端分離架構，通過 RESTful API 通信

## Tasks

- [x] 1.0 系統基礎架構與身份驗證系統建立
  - [x] 1.1 專案初始化與環境配置
    - [x] 1.1.1 建立 Golang 專案結構，初始化 go.mod
    - [x] 1.1.2 安裝並配置 Gin 框架
    - [x] 1.1.3 建立 Next.js 前端專案
    - [x] 1.1.4 配置開發環境的 Docker Compose（MySQL, Redis）
    - [x] 1.1.5 建立基本的目錄結構（models, controllers, services, middleware）
  - [x] 1.2 資料庫設計與初始化
    - [x] 1.2.1 設計使用者表結構（users, roles, permissions）
    - [x] 1.2.2 設計玩家表結構（players, player_status）
    - [x] 1.2.3 設計遊戲相關表結構（games, game_configs, game_sessions）
    - [x] 1.2.4 設計財務相關表結構（transactions, balances, deposits）
    - [x] 1.2.5 設計代理商表結構（agents, agent_hierarchy）
    - [x] 1.2.6 建立資料庫遷移文件
    - [x] 1.2.7 執行資料庫初始化和種子數據
  - [x] 1.3 後端基礎架構建立
    - [x] 1.3.1 建立資料庫連接配置（MySQL, Redis）
    - [x] 1.3.2 實現 GORM 模型定義
    - [x] 1.3.3 建立基本的 HTTP 路由結構
    - [x] 1.3.4 實現錯誤處理中介軟體
    - [x] 1.3.5 實現日誌記錄中介軟體
    - [x] 1.3.6 建立 API 回應格式標準化
  - [x] 1.4 身份驗證系統實現
    - [x] 1.4.1 實現 JWT Token 生成和驗證
    - [x] 1.4.2 建立登入 API 端點
    - [x] 1.4.3 建立登出 API 端點
    - [x] 1.4.4 實現密碼加密和驗證
    - [x] 1.4.5 建立 Token 刷新機制
    - [x] 1.4.6 實現身份驗證中介軟體
  - [⏸️] 1.5 權限控制系統建立 (延後 - Deferred)
    - [ ] 1.5.1 定義角色權限映射（管理者、代理商、經銷商）
    - [ ] 1.5.2 實現基於角色的權限檢查中介軟體
    - [ ] 1.5.3 建立權限管理 API
    - [ ] 1.5.4 實現操作日誌記錄系統
    - [ ] 1.5.5 建立使用者會話管理
  - [⏸️] 1.6 前端基礎架構建立 (延後 - Deferred)
    - [ ] 1.6.1 設置 TypeScript 配置
    - [ ] 1.6.2 安裝並配置 Bootstrap 和 UI 組件庫
    - [ ] 1.6.3 建立主要佈局組件（側邊欄、導航欄）
    - [ ] 1.6.4 實現 API 服務層和 HTTP 客戶端
    - [ ] 1.6.5 建立身份驗證相關組件（登入表單）
    - [ ] 1.6.6 實現前端路由保護機制

- [ ] 2.0 玩家管理系統開發
  - [x] 2.1 玩家資料模型建立
    - [x] 2.1.1 完善玩家基本資料模型（姓名、聯絡方式、註冊時間）
    - [x] 2.1.2 建立玩家狀態管理模型（啟用、停用、限制）
    - [x] 2.1.3 設計玩家標籤和分類系統
    - [x] 2.1.4 建立玩家遊戲歷史記錄模型
  - [x] 2.2 玩家查詢功能實現
    - [x] 2.2.1 實現玩家列表查詢 API（支援分頁、排序）
    - [x] 2.2.2 新增進階搜尋功能（姓名、郵件、註冊日期範圍）
    - [x] 2.2.3 實現玩家詳細資訊查詢 API
    - [x] 2.2.4 新增玩家遊戲歷史查詢功能
  - [ ] 2.3 玩家點數管理功能
    - [ ] 2.3.1 實現玩家點數餘額查詢 API
    - [ ] 2.3.2 實現玩家點數充值 API
    - [ ] 2.3.3 實現玩家點數調整 API（增加、減少）
    - [ ] 2.3.4 建立點數變動歷史記錄
    - [ ] 2.3.5 實現點數變動通知機制
  - [ ] 2.4 玩家狀態管理功能
    - [ ] 2.4.1 實現玩家帳戶啟用/停用 API
    - [ ] 2.4.2 實現玩家限制設定 API（下注限額、遊戲限制）
    - [ ] 2.4.3 建立玩家風險評估系統
    - [ ] 2.4.4 實現玩家註銷功能
  - [ ] 2.5 玩家分析功能
    - [ ] 2.5.1 實現玩家行為模式分析
    - [ ] 2.5.2 實現玩家遊戲偏好統計
    - [ ] 2.5.3 實現玩家消費習慣分析
    - [ ] 2.5.4 建立玩家價值評分系統
  - [ ] 2.6 玩家管理前端界面
    - [ ] 2.6.1 建立玩家列表展示組件
    - [ ] 2.6.2 建立玩家詳細資料展示組件
    - [ ] 2.6.3 建立玩家點數管理組件
    - [ ] 2.6.4 建立玩家狀態管理組件
    - [ ] 2.6.5 建立玩家搜尋和篩選組件

- [ ] 3.0 遊戲管理系統開發
  - [ ] 3.1 遊戲基礎模型建立
    - [ ] 3.1.1 設計遊戲基本資訊模型（ID、名稱、類型、描述）
    - [ ] 3.1.2 設計遊戲配置參數模型（難易度、AI強度、特殊規則）
    - [ ] 3.1.3 設計遊戲狀態模型（啟用、停用、維護）
    - [ ] 3.1.4 建立遊戲版本管理模型
  - [ ] 3.2 遊戲新增管理功能
    - [ ] 3.2.1 實現新增遊戲 API（基本資訊設定）
    - [ ] 3.2.2 實現遊戲規則配置 API
    - [ ] 3.2.3 實現遊戲參數模板系統
    - [ ] 3.2.4 建立遊戲驗證和測試機制
  - [ ] 3.3 遊戲狀態控制功能
    - [ ] 3.3.1 實現單一遊戲啟用/停用 API
    - [ ] 3.3.2 實現批量遊戲狀態控制 API
    - [ ] 3.3.3 實現遊戲維護模式切換
    - [ ] 3.3.4 建立遊戲狀態變更通知系統
  - [ ] 3.4 遊戲參數調整功能
    - [ ] 3.4.1 實現遊戲難易度調整 API
    - [ ] 3.4.2 實現 AI 強度調整 API
    - [ ] 3.4.3 實現特殊規則配置 API
    - [ ] 3.4.4 建立參數變更歷史記錄
    - [ ] 3.4.5 實現參數回滾功能
  - [ ] 3.5 賠率管理功能
    - [ ] 3.5.1 實現基礎賠率設定 API
    - [ ] 3.5.2 實現分時段賠率設定功能
    - [ ] 3.5.3 實現動態賠率調整機制
    - [ ] 3.5.4 建立賠率變更歷史記錄
    - [ ] 3.5.5 實現賠率風險評估系統
  - [ ] 3.6 下注限制設定功能
    - [ ] 3.6.1 實現最低/最高下注金額設定 API
    - [ ] 3.6.2 實現單日下注限制設定 API
    - [ ] 3.6.3 實現玩家級別下注限制
    - [ ] 3.6.4 實現時段性下注限制
    - [ ] 3.6.5 建立下注限制違規檢測
  - [ ] 3.7 遊戲監控功能
    - [ ] 3.7.1 實現即時遊戲狀態監控 API
    - [ ] 3.7.2 實現玩家數量統計功能
    - [ ] 3.7.3 實現投注金額即時統計
    - [ ] 3.7.4 實現營收狀況即時計算
    - [ ] 3.7.5 建立異常警報系統
  - [ ] 3.8 遊戲記錄與風險控制
    - [ ] 3.8.1 實現遊戲下注記錄查詢 API
    - [ ] 3.8.2 實現遊戲結果記錄 API
    - [ ] 3.8.3 建立自動風控規則引擎
    - [ ] 3.8.4 實現異常下注模式檢測
    - [ ] 3.8.5 建立風險警報和處理機制
  - [ ] 3.9 遊戲管理前端界面
    - [ ] 3.9.1 建立遊戲列表管理組件
    - [ ] 3.9.2 建立遊戲新增/編輯組件
    - [ ] 3.9.3 建立遊戲狀態控制組件
    - [ ] 3.9.4 建立賠率管理組件
    - [ ] 3.9.5 建立遊戲監控儀表板組件

- [ ] 4.0 財務管理系統開發
  - [ ] 4.1 財務基礎模型建立
    - [ ] 4.1.1 設計交易記錄模型（類型、金額、時間、狀態）
    - [ ] 4.1.2 設計帳戶餘額模型（點數、現金、凍結金額）
    - [ ] 4.1.3 設計儲值記錄模型（來源、方式、確認狀態）
    - [ ] 4.1.4 建立財務對帳模型
  - [ ] 4.2 點數儲值功能
    - [ ] 4.2.1 實現儲值請求建立 API
    - [ ] 4.2.2 實現儲值狀態查詢 API
    - [ ] 4.2.3 實現儲值確認處理 API
    - [ ] 4.2.4 建立儲值失敗處理機制
    - [ ] 4.2.5 實現儲值記錄查詢功能
  - [ ] 4.3 輸贏記錄管理
    - [ ] 4.3.1 實現遊戲輸贏記錄 API
    - [ ] 4.3.2 實現輸贏明細查詢 API
    - [ ] 4.3.3 實現輸贏統計分析功能
    - [ ] 4.3.4 建立輸贏數據驗證機制
  - [ ] 4.4 資金流水追蹤
    - [ ] 4.4.1 實現資金變動記錄 API
    - [ ] 4.4.2 實現流水查詢和篩選功能
    - [ ] 4.4.3 建立資金流向分析
    - [ ] 4.4.4 實現可疑交易檢測
  - [ ] 4.5 對帳功能實現
    - [ ] 4.5.1 實現日對帳報表生成
    - [ ] 4.5.2 實現週對帳報表生成
    - [ ] 4.5.3 實現月對帳報表生成
    - [ ] 4.5.4 建立對帳差異檢測和處理
    - [ ] 4.5.5 實現對帳報表匯出功能
  - [ ] 4.6 財務管理前端界面
    - [ ] 4.6.1 建立財務概覽儀表板
    - [ ] 4.6.2 建立儲值管理組件
    - [ ] 4.6.3 建立交易記錄查詢組件
    - [ ] 4.6.4 建立對帳報表組件
    - [ ] 4.6.5 建立財務統計圖表組件

- [ ] 5.0 代理商/經銷商管理系統開發
  - [ ] 5.1 代理商模型建立
    - [ ] 5.1.1 設計代理商基本資料模型
    - [ ] 5.1.2 設計經銷商基本資料模型
    - [ ] 5.1.3 設計代理商層級關係模型
    - [ ] 5.1.4 建立分潤配置模型
  - [ ] 5.2 代理商註冊管理
    - [ ] 5.2.1 實現代理商註冊 API
    - [ ] 5.2.2 實現代理商資料驗證
    - [ ] 5.2.3 實現代理商狀態管理
    - [ ] 5.2.4 建立代理商審核流程
  - [ ] 5.3 經銷商管理功能
    - [ ] 5.3.1 實現經銷商新增 API
    - [ ] 5.3.2 實現經銷商編輯 API
    - [ ] 5.3.3 實現經銷商查詢功能
    - [ ] 5.3.4 建立經銷商狀態管理
  - [ ] 5.4 分潤設定功能
    - [ ] 5.4.1 實現多層級分潤比例設定 API
    - [ ] 5.4.2 實現分潤規則配置
    - [ ] 5.4.3 建立分潤模板系統
    - [ ] 5.4.4 實現分潤設定歷史記錄
  - [ ] 5.5 分潤計算功能
    - [ ] 5.5.1 實現自動分潤計算引擎
    - [ ] 5.5.2 實現分潤分配 API
    - [ ] 5.5.3 建立分潤計算驗證機制
    - [ ] 5.5.4 實現分潤調整和補發功能
  - [ ] 5.6 下線管理功能
    - [ ] 5.6.1 實現代理商下線關係建立
    - [ ] 5.6.2 實現下線關係查詢 API
    - [ ] 5.6.3 建立下線績效統計
    - [ ] 5.6.4 實現下線關係調整功能
  - [ ] 5.7 代理商管理前端界面
    - [ ] 5.7.1 建立代理商列表管理組件
    - [ ] 5.7.2 建立經銷商管理組件
    - [ ] 5.7.3 建立分潤設定組件
    - [ ] 5.7.4 建立下線關係管理組件
    - [ ] 5.7.5 建立分潤計算和分配組件

- [ ] 6.0 報表與分析系統開發
  - [ ] 6.1 報表基礎架構建立
    - [ ] 6.1.1 設計報表數據模型
    - [ ] 6.1.2 建立報表生成引擎
    - [ ] 6.1.3 實現報表快取機制
    - [ ] 6.1.4 建立報表排程系統
  - [ ] 6.2 獲利報表功能
    - [ ] 6.2.1 實現整體獲利統計 API
    - [ ] 6.2.2 實現分遊戲獲利分析
    - [ ] 6.2.3 實現獲利趨勢分析
    - [ ] 6.2.4 建立獲利預測模型
  - [ ] 6.3 分潤報表功能
    - [ ] 6.3.1 實現分潤明細報表 API
    - [ ] 6.3.2 實現分潤統計分析
    - [ ] 6.3.3 建立分潤效率分析
    - [ ] 6.3.4 實現分潤報表匯出功能
  - [ ] 6.4 玩家分析報表
    - [ ] 6.4.1 實現玩家行為分析報表
    - [ ] 6.4.2 實現玩家消費分析報表
    - [ ] 6.4.3 建立玩家留存率分析
    - [ ] 6.4.4 實現玩家價值分群分析
  - [ ] 6.5 營運儀表板功能
    - [ ] 6.5.1 實現即時關鍵指標顯示
    - [ ] 6.5.2 建立營運健康度評估
    - [ ] 6.5.3 實現警報和通知系統
    - [ ] 6.5.4 建立儀表板自訂功能
  - [ ] 6.6 自訂報表功能
    - [ ] 6.6.1 實現報表查詢條件設定
    - [ ] 6.6.2 建立報表格式自訂功能
    - [ ] 6.6.3 實現報表儲存和分享
    - [ ] 6.6.4 建立報表權限控制
  - [ ] 6.7 報表分析前端界面
    - [ ] 6.7.1 建立營運儀表板組件
    - [ ] 6.7.2 建立獲利分析圖表組件
    - [ ] 6.7.3 建立玩家分析圖表組件
    - [ ] 6.7.4 建立自訂報表建立器
    - [ ] 6.7.5 建立報表匯出和分享功能 

## 相關檔案

- `backend/main.go` - 主要應用程式進入點，設定 Gin 伺服器和路由
- `backend/config/config.go` - 應用程式配置管理
- `backend/config/database.go` - 資料庫連線配置與管理
- `backend/models/user.go` - 使用者模型定義，包含角色管理以及密碼加密功能
- `backend/services/auth.go` - JWT Token 生成和驗證服務，包含使用者身份驗證功能
- `backend/controllers/auth.go` - 身份驗證控制器，包含登入、登出、Token 刷新等 API 端點
- `backend/controllers/admin.go` - 管理員控制器處理登入、使用者管理等功能
- `backend/controllers/game.go` - 遊戲控制器處理遊戲管理功能
- `backend/controllers/financial.go` - 財務控制器處理支付和財務報表
- `backend/controllers/agent.go` - 代理商控制器處理代理商管理功能
- `backend/controllers/report.go` - 報表控制器處理各類報表生成
- `backend/middleware/middleware.go` - 中介軟體包含身份驗證和權限檢查
- `backend/routes/routes.go` - 路由設定包含所有 API 端點
- `backend/controllers/admin.go.test` - 管理員控制器的單元測試
- `backend/services/auth.go.test` - 身份驗證服務的單元測試
- `api.json` - API 文檔檔案，記錄所有 API 端點的詳細資訊，便於 PM2 管理 