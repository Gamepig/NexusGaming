# 系統模式與架構

## 主要架構

-   **前後端分離**: 
    -   Golang 後端 API 服務。
    -   Vanilla JS + Chart.js 後台管理前端。
    -   Three.js 遊戲客戶端前端。
-   **微服務化 (部分)**: 獨立的 Python AI 服務，負責模型推理。
-   **通信**: 後台前端、遊戲客戶端前端通過 API/WebSocket 與 Golang 後端交互。

## 設計模式

-   **API Gateway (隱含)**: Golang 後端作為後台前端、遊戲客戶端前端以及 AI 服務的統一入口和協調者。
-   **Repository/數據訪問層**: 使用 GORM 封裝 MySQL 操作，使用官方 MongoDB Go Driver 封裝 MongoDB 操作。
-   **服務客戶端**: Golang 中封裝對 Python AI 服務的 HTTP/gRPC 調用。
-   **實時通信**: 使用 WebSocket (例如通過 Gin 的擴展或專門的庫) 實現遊戲客戶端與後端之間的實時遊戲狀態同步和事件推送。
-   **定時任務 (Cron)**: 用於定期的特徵提取、行為分析、報表生成、佣金結算等。
-   **JWT 身份驗證**: 用於保護後台管理 API 和 玩家遊戲會話。
-   **基於角色的訪問控制 (RBAC)**: 管理不同後台用戶對各功能模組的細粒度操作權限。
-   **配置管理**: 將遊戲規則、返水比例、佣金策略等可變參數儲存在數據庫或配置文件中，方便動態調整。

## 數據流模式

-   **核心業務數據 (MySQL)**: 會員資訊、帳戶餘額、交易記錄（充值、提現、開分）、代理結構、佣金記錄、核心配置等結構化數據存儲在 MySQL。
-   **日誌與遊戲記錄 (MongoDB)**: 遊戲客戶端產生的詳細遊戲交互記錄、玩家操作日誌、後台管理員操作日誌、系統錯誤日誌等大量、半結構化數據存儲在 MongoDB。
-   **數據快取 (Redis)**: 常用配置、用戶會話、遊戲房間狀態、排行榜、AI 特徵等存儲在 Redis 以加速訪問。
-   **行為分析流程**: 定時任務從 MySQL/MongoDB 提取數據 -> 進行特徵工程 -> 調用 Python AI 服務進行分析 (異常檢測/分類) -> 分析結果存回 MySQL。
-   **AI 對弈流程**: 遊戲客戶端發起動作 -> WebSocket/API 請求至 Golang 後端 -> 後端查詢 Redis/MySQL/MongoDB 獲取對局狀態和特徵 -> 調用 Python AI 服務獲取對弈決策 -> 後端通過 WebSocket 將決策或遊戲狀態更新推送給客戶端。
-   **報表生成流程**: 定時任務或手動觸發 -> 從 MySQL/MongoDB 聚合數據 -> 生成報表數據 -> 後台前端通過 API 獲取並使用 Chart.js 視覺化。

## 部署模式

-   **容器化**: 使用 Docker 打包各個服務。
-   **容器編排**: 使用 Kubernetes 進行部署、擴展和管理。 